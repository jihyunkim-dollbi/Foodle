<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.restaurantdetail-mapper">

	<select id="resDetailMaininfo" resultType="MainInfoVO" parameterType="int">
		SELECT * FROM maininfo
		WHERE rno=#{no}
	</select>
	
	<select id="resDetailSubinfo" resultType="SubinfoVO" parameterType="int">
		SELECT * FROM subinfo
		WHERE rno=#{no}
	</select>
	
	<select id="resDetailReserveinfo" resultType="ReserveInfoVO" parameterType="int">
		SELECT * FROM reserveinfo
		WHERE rno=#{no}
	</select>
	
	<select id="resDetailMenu" resultType="MenuVO" parameterType="int">
		SELECT * FROM menu
		WHERE rno=#{no}
	</select>
	
	<select id="resDetailImage" resultType="ImageVO" parameterType="int">
		SELECT rNo,iName,iLink FROM image
		WHERE rNo=#{no} AND rownum&lt;=6
	</select>
	
	
	<!-- 찜 체크 -->
	<select id="myWishCheck" resultType="int" parameterType="hashMap">
		SELECT COUNT(*) FROM mywish
		WHERE rno=#{rno} AND userid=#{id}
	</select>
	
	
	<!-- 찜 INSERT -->
	<insert id="myWishInsert" parameterType="hashMap">
		INSERT INTO mywish VALUES(
			(SELECT NVL(MAX(wishno)+1,1) FROM mywish),
			#{rno},#{id},SYSDATE
		)
	</insert>
	
	<!-- 찜 DELETE -->
	<delete id="myWishDelete" parameterType="hashMap">
		DELETE FROM mywish
		WHERE rno=#{rno} AND userid=#{id}
	</delete>
	
	<!-- 찜 리스트 가져오기 -->
	<!-- <select id="myWishList" resultType="MyWishVO" parameterType="String">
		SELECT wishno,rno,regdate
		FROM mywish
		WHERE userid=#{id}
	</select> -->
	
	<!-- #################################### 리뷰 ################################### -->
	<!-- 리뷰 데이터 -->
	<select id="reviewData" resultType="ReviewVO" parameterType="hashMap">
		SELECT reviewno,userid,rno,revscore,revcontent,revdate,revgood,revbad,num
		FROM (SELECT reviewno,userid,rno,revscore,revcontent,revdate,revgood,revbad,rownum as num
		FROM (SELECT reviewno,userid,rno,revscore,revcontent,revdate,revgood,revbad 
		FROM review WHERE rno=#{rno} ORDER BY revdate DESC))
		WHERE num BETWEEN #{start} AND #{end}
	</select>
	
	<!-- 리뷰 개수 -->
	<select id="reviewTotalCount" resultType="int" parameterType="int">
		SELECT COUNT(*) FROM review
		WHERE rno=#{rno}
	</select>
	
	<!-- 리뷰 총 페이지 -->
	<select id="reviewTotalPage" resultType="int" parameterType="int">
		SELECT CEIL(COUNT(*)/10.0)
		FROM review
		WHERE rno=#{rno}
	</select>
	
	<!-- 리뷰 평점 평균 -->
	<select id="reviewScoreAvg" resultType="double" parameterType="int">
		SELECT TRUNC(AVG(revscore),1) FROM review
		WHERE rno=#{rno}
	</select>
	
	
</mapper>